{% extends 'flare/base.html' %}

{% from 'flare/_helpers.html' import render_plan, render_item_labels %}

{% block title %}Забота: {{ item.risk or item.need }}{% endblock %}
{% block heading %}
    {% if item %}
        {{ (item.risk or item.need)|capfirst|hashtagify|safe }}
    {% else %}
        (Несуществующий элемент)
    {% endif %}
{% endblock %}
{% block content %}

    {% if item %}

        <p>{{ render_item_labels(item) }}</p>

        <dl class="dl-horizontal">

        {% if item.log %}
            <dt>Создан</dt>
            <dd>{{ render_delta(item.first_log_entry.time, now()) }} назад</dd>

            <dt>Изменен</dt>
            <dd>{{ render_delta(item.last_log_entry.time, now()) }} назад</dd>
        {% endif %}

        {% if item.note %}
            <dt>Заметка</dt>
            <dd>{{ item.note|capfirst|hashtagify|safe }}.</dd>
        {% endif %}

        {% if item.risk %}
            {% if item.need %}
                <dt>Цель</dt>
                <dd>{{ item.need }}.</dd>
            {% else %}
                <dt>Цель</dt>
                <dd>(Положительный результат не проработан.)</dd>
            {% endif %}
        {% endif %}

        {% if item.stakeholders %}
            <dt>Участники</dt>
            {% for person in item.stakeholders %}
                <dd><a href="{{ url_for('flow.contact_detail', slug=person) }}"><i class="icon-user"></i> {{ person }}</a></dd>
            {% endfor %}
        {% endif %}

        {% if item.cost.amount %}
            <dt>Стоимость</dt>
            <dd>{{ item.cost.amount }} <em>{{ item.cost.currency }}</em></dd>
        {% endif %}

        </dl>

        <h2>Планы</h2>
        {% for plan in item.plan %}
            <p>{{ render_plan(plan) }}</p>
        {% endfor %}

        {% if item.log %}
            <h2>История</h2>
            <dl class="dl-horizontal">
                {% for record in item.log %}
                    <dt>{{ record.time }}</dt>
                    <dd>{{ record.mode }}</dd>
                {% endfor %}
            </dl>
        {% endif %}

    {% else %}

        <div class="alert alert-block">
            <h2 class="alert-heading">Нет данных</h2>
            Вероятно, такого требования нет.
        </div>

    {% endif %}

{% endblock %}
